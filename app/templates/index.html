<!DOCTYPE html>
<html>
<head>
    <title>EMOS Configurator</title>
    <style>
    .switch {position: relative; display: inline-block; width: 50px; height: 24px;}
    .switch input {display:none;}
    .slider {position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background-color:#ccc; transition:.4s; border-radius:24px;}
    .slider:before {position:absolute; content:""; height:18px; width:18px; left:3px; bottom:3px; background-color:white; transition:.4s; border-radius:50%;}
    input:checked + .slider {background-color:#2196F3;}
    input:checked + .slider:before {transform: translateX(26px);}
    #sniffOptions {margin-top: 8px; display: none;}
    </style>
</head>
<body>
    <h1>EMOS Configurator</h1>
    <form id="discoverForm" method="post" action="/discover">
        <label class="switch">
            <input type="checkbox" id="modeToggle" name="mode" value="sniff" {% if mode == 'sniff' %}checked{% endif %}>
            <span class="slider"></span>
        </label>
        <span id="modeLabel">{% if mode == 'sniff' %}Sniff{% else %}Scan{% endif %}</span>
        <div id="sniffOptions">
            <input type="text" id="subnet" name="subnet" placeholder="Subnet" value="{{ subnet }}">
            <button type="button" id="detectSubnetBtn">Gebruik eth0 subnet</button>
        </div>
        <button type="submit">Ontdekken</button>
    </form>
    <form method="get" action="/">
        <button type="submit">Refresh</button>
    </form>
    <form method="post" action="{% if eth0_static %}/dhcp{% else %}/business{% endif %}">
        <button type="submit">{% if eth0_static %}DHCP Mode{% else %}Switch to Business Mode{% endif %}</button>
    </form>

    {% if scan_results %}
    <h2>Resultaten</h2>
    <ul>
        {% for ip in scan_results %}
        <li>{{ ip }}</li>
        {% endfor %}
    </ul>
{% endif %}
{% if cameras %}
    {% for camera_id, setting in cameras.items() %}
    <h2>Camera {{ camera_id }}</h2>
    <form method="post" action="/settings/{{ camera_id }}">
        <label>Codec:</label>
        <select name="codec">
            <option value="MJPEG" {% if setting.codec == 'MJPEG' %}selected{% endif %}>MJPEG</option>
            <option value="H264" {% if setting.codec == 'H264' %}selected{% endif %}>H264</option>
        </select>
        <label>Multicast Port:</label>
        <input type="number" name="port" value="{{ setting.port }}" />
        <button type="submit">Save</button>
    </form>
    {% endfor %}
    {% else %}
    <p>No cameras detected.</p>
{% endif %}
<script>
const toggle = document.getElementById('modeToggle');
const sniffOpts = document.getElementById('sniffOptions');
const label = document.getElementById('modeLabel');

function updateView() {
    if (toggle.checked) {
        label.textContent = 'Sniff';
        sniffOpts.style.display = 'block';
    } else {
        label.textContent = 'Scan';
        sniffOpts.style.display = 'none';
    }
}

toggle.addEventListener('change', updateView);
updateView();

document.getElementById('detectSubnetBtn').addEventListener('click', () => {
    fetch('/eth0_subnet').then(r => r.json()).then(data => {
        document.getElementById('subnet').value = data.subnet || '';
    });
});
</script>
</body>
</html>

